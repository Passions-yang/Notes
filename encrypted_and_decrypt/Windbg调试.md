# Windbg调试

### 调试符号
    * 需要在windows官网上下载符号信息文件。
    * 指定加载路径
    * 就可以在调试器中查看内部函数，变量名，结构体定义等。

## 调试过程
    调试分为远程调试和内核调试
    内核模式：NET、USB、1394、COM和本地调试
###  开始调试
        可以对正在运行的程序进行附加调试，按ctrl+E快捷键可以打开一个
    应用程序，并指定参数进行调试，按F6可以从对话框中选择当前正在运行的
    附加进程进行调试。
        Windbg调试是，反汇编代码并不会停在程序入口处，会停在ntdll.dll
    中的系统中断处，所以需要在命令窗口“Alt+l”输入“:g@$exentry”转到
    程序入口。
### 控制目标程序执行命令
| 命令 | 快捷键 | 功能 |
|:---:|:------:|:----:|
| t | F8 或 F11 | 追踪执行，遇到call指令是跟进 |
| p | F10 | 单步执行，遇到call指令时路过，不跟进|
| g | F5 | 运行程序 |
| pa 地址 | | 单步到指定地址，不进入call指令 |
| ta 地址 | | 追踪到指定地址，进入到call指令 |
|....|...|...|
        因为伪寄存器$ra代表当前函数的返回地址，所以使用pa或者ta命令加上
    @$ra来走出当前函数，例： pa $ra
## 断点命令
#### 软件断点
        Windbg 有三条命令用于设置软件断点（INT3），分别是bp,bu,bm，
    其中bp是最长用的。格式如下：
```
bp[ID] [Options] [Address [Passes]] ["CommandString"]
```
    * ID：指定断点，可缺省，内核调试限制32个断点，用户模式不限。
    * Options: 可缺省。
        1、 /1 : 中断后自动删除该断点，即一次性断点。
        2、 /c ： 指定最大调用深度，大于这个深度断点不工作。
        3、 /C ： 指定最小调用深度，小于这个深度断点不工作。
    * Adress: 地址或符号，例如：MessageBoxW。
    * Passes: 忽略中断的次数，可缺省。
    * CommandString:用于指定一组命令，当中断时，WInDbg自动执行这组命令
    ，用双引号将命令包围起来，多个命令用分号分隔。  
    bp： bp断点时设置地址的断点，它设置在地址上，如果模块把该地址的指令
        移到其他地方，断点不会随之移动。
    bu：是对于符号下断点，例如：bu kernal32!GetVersion。断点和符号关联。
        地址改变，bu跟随符号移动。
    bm： 命令设置含有通配符的断点。例如："bm msvcr80d!print*"。
#### 硬件断点
    硬件断点有时间限制，但是能实现软件断点实现不了的功能，例如监控I/O。
    断点格式如下：
```
ba[ID] Access Size [Options] [Address [Passes]] ["CommandString"]
```
    * ID：指定断点，可缺省，内核调试限制32个断点，用户模式不限。
    * Access: 指定断点触发断点的访问方式。
        1、 e ： 在读取或执行指令是触发断点。
        2、 r ： 在读取数据时触发断点。
        3、 w ： 在写入数据时，触发断点。
        4、 i ： 只执行输入/输出访问时触发断点。
    * Size: 访问的长度。
    * Address:断点的地址，地址值按照Size的值进行内存对齐。
    * CommandString:用于指定一组命令，当中断时，WInDbg自动执行这组命令
    ，用双引号将命令包围起来，多个命令用分号分隔。  

    限制：
        由于设置软件断点时，会修改相应的代码，所以不能调试Flash和ROM中
    的只读代码，硬件断点没有限制，因为使用的是寄存器。
